<!DOCTYPE html>
<html lang="en">

<head>
    <title>Plots - RealEstateAI</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body data-page="plot_list" class="bg-gray-100">

    <nav class="sticky top-0 z-50 bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-3xl font-bold text-green-600 cursor-pointer">RealEstateAI</h1>

            <div class="hidden md:flex space-x-8 font-medium text-gray-700 items-center">
                <a href="index.html" class="hover:text-green-600">Home</a>
                <a href="listings.html" class="hover:text-green-600">Buy</a>
                <a href="contact.html" class="hover:text-green-600">Contact</a>
                
                <!-- Notification Bell -->
                <div class="relative">
                    <button id="notificationBell" class="relative p-2 hover:bg-gray-100 rounded-full transition-colors duration-200">
                        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                        </svg>
                        <span id="notificationBadge" class="hidden absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                    </button>
                    
                    <!-- Notification Dropdown -->
                    <div id="notificationDropdown" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 max-h-96 overflow-y-auto z-50">
                        <div class="p-4 border-b border-gray-200">
                            <h3 class="font-semibold text-gray-800">New Followups</h3>
                        </div>
                        <div id="notificationList" class="divide-y divide-gray-100">
                            <!-- Notifications will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <a href="contact.html" class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg shadow-md">
                Schedule Visit
            </a>
        </div>
    </nav>

    <section class="max-w-7xl mx-auto p-8 bg-white shadow rounded mt-6">
        <h2 class="text-3xl font-bold mb-6">Available Plots</h2>

        <div id="plotGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        </div>
    </section>

    <footer class="bg-gray-900 text-gray-300 mt-16 text-center p-6">
        © 2026 RealEstateAI. All rights reserved.
    </footer>

    <script>
        const BASE_URL = "https://api.appolyse.com";

        const plotGrid = document.getElementById("plotGrid");

        function getImageUrl(path) {
            if (!path) return "";
            return path.startsWith("http") ? path : `${BASE_URL}${path}`;
        }

        async function loadPlots() {
            try {
                const res = await fetch(`${BASE_URL}/plots`);
                const plots = await res.json();

                plotGrid.innerHTML = "";

                plots.forEach(p => {
                    const card = document.createElement("div");
                    card.className =
                        "bg-gray-50 rounded overflow-hidden shadow hover:shadow-lg cursor-pointer transition";

                    card.innerHTML = `
                        <img src="${getImageUrl(p.main_image)}" class="w-full h-64 object-cover">
                        <div class="p-4">
                            <h3 class="font-semibold text-xl">${p.title}</h3>
                            <p class="text-green-600 font-bold text-lg">${p.price}</p>
                            <p class="text-gray-500 text-sm">${p.area || "N/A"} • ${p.location || ""}</p>
                        </div>
                    `;
                    card.onclick = () => {
                        window.location.href =
                            `plot_information.html?property_id=${p.property_id}`;
                    };

                    plotGrid.appendChild(card);
                });

            } catch (err) {
                console.error("Error loading plots:", err);
            }
        }

        loadPlots();
    </script>
    <script src="js/tracking.js"></script>
    <script src="js/notifications.js"></script>
    <script>
        // Notification bell toggle
        document.addEventListener('DOMContentLoaded', () => {
            const notificationBell = document.getElementById("notificationBell");
            const notificationDropdown = document.getElementById("notificationDropdown");
            
            if (notificationBell) {
                notificationBell.addEventListener("click", (e) => {
                    e.stopPropagation();
                    notificationDropdown.classList.toggle("hidden");
                });

                document.addEventListener("click", () => {
                    notificationDropdown.classList.add("hidden");
                });

                notificationDropdown.addEventListener("click", (e) => {
                    e.stopPropagation();
                });
            }
        });
    </script>
</body>

</html>